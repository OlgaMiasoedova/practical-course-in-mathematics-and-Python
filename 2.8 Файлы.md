[Чтение из файла](#text1)
[Задание 1.](#task1)
[Задание 2.](#task2)
[Задание 4.](#task4)
[Курсор](#text2)
[Путь к файлу](#text3)
[Задание 5](#task5)
[With - менеджер контекста](#text3)
[А что, если файла нет?](#text4)
[Задание 6](#task6)
[Запись в файл](#text5)
[Задание 7](#task7)
[Задание 8](#task8)



Python позволяет работать как с текстовыми (txt, csv, xml, json и т.п. данные), так и с бинарными (изображения, музыка и т.п.) файлами.

Прежде чем начать работать с файлом его необходимо открыть.

```python
f = open('text.txt', 'r') #Открываем файл с именем text.txt для последующего чтения
```

- 1й параметр - имя файла
- 2й параметр - режим открытия файла

Файл можно открыть на чтение, запись, изменение и т.п.

|   |   |
|---|---|
|Режим|Обозначение|
|'r'|открытие на чтение (является значением по умолчанию).|
|'w'|открытие на запись, содержимое файла удаляется, если файла не существует, создается новый.|
|'x'|открытие на запись, если файла не существует, иначе исключение.|
|'a'|открытие на дозапись, информация добавляется в конец файла.|
|'b'|открытие в двоичном режиме.|
|'t'|открытие в текстовом режиме (является значением по умолчанию).|
|'+'|открытие на чтение и запись|

**Обратите внимание, что в переменную f в примере выше не попадает содержимое файла!**

Фактически это "ссылка" на файл, ещё иногда её называют "файл хэндлер" или дескриптор.

## Кодировка

Если вы открываете файл, содержащий только латиницу и цифры, то вам может хватить и просто открытия файла.

Если же вы работаете с текстом на русском, то скорее всего придётся указать кодировку, для этого служит атрибут encoding.

```python
f = open('text.txt', 'r', encoding="utf-8") #Открываем файл с именем text.txt, имеющего кодировку UTF-8 и кириллические символы в содержимом для последующего чтения
```

## Закрытие файлов

После окончания работы с файлом его необходимо закрыть. Для этого есть несколько причин:

- если файл изменялся, то это позволит корректно его сохранить
- файл может потребоваться другим программам, но ваше приложение может его блокировать, что вызовет ошибку
- не стоит держать в памяти лишние данные, которые вам уже не нужны
- удалить открытый кем-то файл проблематично

```python
f = open('text.txt', 'r') #Открываем файл с именем text.txt для последующего чтения

#Тут мог быть ваш код

f.close() #Закрываем файл после окончания работы
```


<a id="text1"></a>
# Чтение из файла

После того как вы открыли файл на чтение (например, с флагом "r") вы можете использовать одну из 3 функций для чтения текстовой информации из файла:

- read() - читает весь текст
- readline() - читает 1 строку
- readlines() - читает весь текст и возвращает список строк

**Примечание.** Любой текстовый файл, имеющий более 1 строки имеет служебные символы переноса строк **\n**.

Все выше перечисленные методы возвращают строки, которые содержат текст, включая символы переноса строк (\n)

**Чтение файла целиком (read())**

```python
f = open('export_file_48603.csv', 'r', encoding="utf-8")
text = f.read()
```

![](https://ucarecdn.com/ade6086d-6189-4b5a-8571-68dd4942ea79/)

строка text содержит всё содержимое файла, включая переносы строк:

![](https://ucarecdn.com/80b66fdb-0590-49bf-af3e-c83437fe1fd4/)

**Чтение файла по одной строке (readline())**

```python
f = open('export_file_48603.csv', 'r', encoding="utf-8")
text = f.readline()
```

Каждый следующий вызов readline() прочитает следующую строку (и так до тех пор пока не кончится весь файл):

![](https://ucarecdn.com/5c4ff3a3-92e3-4383-a42e-9278b8b80f81/)

readline() так же возвращает строку с символом переноса строки:

![](https://ucarecdn.com/2fce0c29-112f-422c-a182-8d81bffc65b7/)

  
**Чтение файла построчно в список (readlines())**

```python
f = open('export_file_48603.csv', 'r', encoding="utf-8")
text = f.readlines()
```

![](https://ucarecdn.com/d5a13875-1deb-4e5c-a939-701265753381/)

Каждая строка в списке так же заканчивается символом переноса строки!

## Построчное чтение файла в цикле for

Python позволяет сразу перебрать все строки файла, обращаясь к дескриптору в цикле for, не создавая списка:

```python
f = open('export_file_48603.csv', 'r', encoding="utf-8")

for string in f:
    #string содержит по 1 строке файла, включая символ переноса строки
```

![](https://ucarecdn.com/d8b72c92-db99-428d-9cda-40274ff3f22d/)


<a id="task1"></a>
**Задание 1.**

Откройте файл, имя которого передаётся на вход, и выведите содержимое на печать.

```python
f = open(input(), 'r')

print(f.read())

f.close()
```


<a id="task2"></a>
**Задание 2.**

Откройте файл, имя которого передаётся на вход.

Файл содержит произвольное количество целых чисел, каждое с новой строки.

Выведите на печать сумму всех целых чисел, записанных в файле.

```python
f = open(input(), 'r')
s = 0

for string in f:
    s += int(string)

print(s)
f.close()
```



<a id="task3"></a>
**Задание 3.**

Откройте файл, имя которого передаётся на вход.

Выведите на печать предпоследнюю строку.

**Примечание1**. Последняя строка может заканчиваться символом переноса строки.

**Примечание2**. Если в конце файла 2 символа переноса строки, значит последняя строка будет содержать ТОЛЬКО символ переноса строки.

```python
f = open(input(), 'r')
s = f.readlines()

print(s[-2])
f.close()
```



<a id="task4"></a>
**Задание 4.**

Представьте себя сотрудником деканата. Преподаватели предоставляют вам по 2 файла, имена которых находятся в переменных:

- sheet - экзаменационную ведомость с фамилиями, именами и отчествами (если есть), оценками и статусами
- mean - среднюю оценку по группе

Ведомость может выглядеть следующим образом:

```scss
Аттила 2 (экзамен)
Бонапарт Наполеон (неявка)
Гассан Абдуррахман ибн Хоттаб 5 (автомат)
Задойный Алексей Владимирович 5 (экзамен)
Колонна-Валевский Александр Флориан Жозеф (недопуск)
Цезарь Гай Юлий 4 (экзамен)
```

Последнее значение (в скобках) - статус:

- экзамен - человек пришёл на экзамен и получил там оценку
- автомат - человек хорошо учился и получил оценку "автоматом" до экзамена
- неявка - человек не пришёл на экзамен и у него нет оценки
- недопуск - человек не сдал зачёт по физкультуре, а потому его не допустили к нашему экзамену

Средняя оценка вычисляется только для тех, кто сдавал экзамен очно или получил автомат

Ваша задача считать данные по всем студентам из файла, вычислить средний балл и сравнить его с тем, что указал преподаватель в mean.

Если средний балл верен - напечатать "OK"

Если средний балл рассчитан с ошибкой - напечатать "ERROR"

```python
ved = open(sheet, 'r')
av = open(mean, 'r')

s = 0
k = 0

for string in ved:
    n = [i for i in string.split()]
    if n[-2].isdigit():
        s += int(n[-2])
        k += 1

if round(s / k) == int(av.read()):
    print('OK')
else:
    print('ERROR')

ved.close()
av.close()
```



<a id="text2"></a>
# Курсор

Курсор - это позиция откуда начинается ваше взаимодействие с файлом. В принципе, это похоже на курсор в текстовом редакторе.

Предположим, у нас есть файл text.txt. Когда мы его открываем, то курсор находится в начале файла (нулевая позиция), это выглядит примерно так:

![](https://ucarecdn.com/91fcdf80-1d50-4750-bc11-a71658a96cfa/)

Если мы считаем 1 строку:

```python
f = open('text.txt', 'r', encoding="utf-8")
read1 = f.readline()
```

То курсор переместится в начале 2 строки (посмотрите как на предыдущем шаге с помощью readline мы считали 3 первых строки).

![](https://ucarecdn.com/25702062-65d8-4aef-b27a-293c39d6b155/)

Чтение всегда происходит слева направо ОТ курсора. Т.е. если сейчас применить функцию read(), то она считает не весь файл, а только оставшиеся 2 строки!

![](https://ucarecdn.com/cd85c082-8caf-4aa2-84f4-63d300037a6c/)

Более того, теперь, после того как мы считали все строки файла курсор находится в конце!

![](https://ucarecdn.com/eb2535ce-9f37-4fed-a107-127c8d768e09/)

Это означает, что после завершения чтения мы больше не можем считать ни одного символа из файла!

![](https://ucarecdn.com/e22f5c85-6ce7-46bc-a3f7-ee558775989e/)

Попытка читать файл, когда курсор в конечной позиции - очень распространённая ошибка начинающих программистов.

Можно предложить 2 решения:

- переоткрыть файл (курсор снова попадёт в начало)
- переместить курсор с помощью функции f.seek(0)

![](https://ucarecdn.com/d5a294d3-9b6e-4ede-a418-9dc034f5bc5f/)

## seek()

**Функция seek() задаёт позицию курсора в байтах!**

Поэтому будьте аккуратны с символами, использующими более 1 байта (например, кириллицей в utf-8), обращение к "промежуточному" байту может быть чревато:

![](https://ucarecdn.com/74f6b4d6-818f-432f-9488-911c42733a44/)



<a id="text3"></a>
# Путь к файлу

Если вы укажете только имя файла, то Python будет искать этот файл в том же каталоге, что и сам скрипт.

Однако, часто данные лежат не там, где код. Тогда необходимо указать путь.

Для этого рекомендуется использовать линуксовую [запись](https://ru.wikipedia.org/wiki/%D0%9F%D1%83%D1%82%D1%8C_%D0%BA_%D1%84%D0%B0%D0%B9%D0%BB%D1%83).

## Относительный путь

![](https://ucarecdn.com/9b3a9689-9a18-4b0a-8726-b486f3916773/)

Если наш скрипт находится в каталоге myProject, то перейти в соседний каталог можно, вернувшись на 1 уровень выше

```kotlin
open('../myData/data2.txt', 'r')
```

Если в каталоге с нашим скриптом есть другой каталог, уже в котором находятся данные, то можно использовать одну из записей:

```ini
f = open('./dir/1.txt', 'r', encoding="utf-8")
# или
f = open('dir/1.txt', 'r', encoding="utf-8")
```

## Абсолютный путь

Не рекомендуется использовать абсолютные пути, т.к. есть риск, что запускать скрипт придётся в другой среде, где пути будут иными. Например, вы разрабатываете на Windows, а запускаете под Linux.

В Linux для написания абсолютного пути (от корневого каталога) просто используйте символ "/":

```swift
open('/Users/joebob01/myFiles/allProjects/myData/data2.txt', 'r')
```

В Windows вам потребуется указать диск и использовать обратные слэши "\", чтобы не испытывать с ними проблем можно поставить перед кавычками символ "r", что сделает строку "сырой", либо использовать двойной "\" (для экранирования):

```python
f = open(r'C:\git\gittest\4.php', 'r', encoding="utf-8")
# или 
f = open('C:\\git\\gittest\\4.php', 'r', encoding="utf-8")
```



<a id="task5"></a>
**Задание 5.**

Вы находитесь в каталоге Project. В нем у вас есть файл с вашим кодом Python. Вы хотели бы прочитать данные из файла с именем «YearlyProjection.csv», который находится в папке с именем CompanyData, которая находится внутри Project. 

Каков наилучший способ открыть файл в вашей программе Python?

Выберите один вариант из списка

 -  [ ] open("Project/CompanyData/YearlyProjection.csv", "r")
 -  [ ] open("../YearlyProjection.csv", "r") 
 -  [x] open("CompanyData/YearlyProjection.csv", "r")
 -  [ ] open("../CompanyData/YearlyProjection.csv", "r") 
 -  [ ] open ("YearlyProjection.csv", "r")



<a id="text4"></a>
# With - менеджер контекста

Как уже ранее было написано, очень важно корректно закрыть файл.

Однако, есть более технологичный способ открытия файла, который автоматически закроет файл после завершения блока инструкций - контекст.

```python
with open('text.txt', 'r', encoding="utf-8") as f:
```

Схема превращения обычной записи в контекст:

![](https://ucarecdn.com/9b1ae224-8211-4dfb-9120-86355d33d116/)

**При такой записи не требуется использовать close()**.

Как только закончится код, оформленный с отступами в with (аналогичные отступы в циклах или функциях), это означает, что контекст закончился, и python автоматически закроет файл.

Пример кода:

```python
with open('text.txt', 'r', encoding="utf-8") as f:
    for line in f:
        print(line)
```



<a id="text5"></a>
## А что если файла нет?

Если файл не существует, то попытка открыть его для чтения приведёт к неприятной ошибке:

![](https://ucarecdn.com/cb541731-1a3a-460c-85a5-593f2d86f94a/)

Безусловно, можно попытаться использовать [исключения (try/except)](https://docs.python.org/3/tutorial/errors.html#handling-exceptions), однако такая конструкция довольно ресурсоёмкая в случае наступления исключительной ситуации (_по этой же причине, например, лучше при делении проверить знаменатель на равенство нулю с помощью If, чем ловить исключение_).

Лучше проверить файл на существование:

```python
import os.path
os.path.isfile('text1111.txt')
```

os.path.isfile возвращает:

- True, если по указанному пути есть файл
- False, если по указанному пути ничего нет, либо путь указывает на каталог, а не на файл

Так же, если ваш файл лежит в каком-то каталоге, то иногда полезно проверить весь путь по частям (т.е. каждый каталог и подкаталог на существование):

```python
import os.path
os.path.exists('dir/')
```

os.path.exists возвращает:

- True, если по указанному пути есть хоть что-то (не важно файл или каталог)
- False, если по указанному пути ничего нет

_[Полезная заметка на тему проверки существования файлов (в том числе try/except/else)](https://ru.stackoverflow.com/questions/414593/%D0%9A%D0%B0%D0%BA-%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%B8%D1%82%D1%8C-%D1%81%D1%83%D1%89%D0%B5%D1%81%D1%82%D0%B2%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D1%84%D0%B0%D0%B9%D0%BB%D0%B0)_



<a id="task6"></a>
**Задание 6.**

На вход подаётся полный путь к файлу относительно текущего каталога.

Проверьте есть ли такой файл (и файл ли это) и если он есть - выведите содержимое. Иначе выведите одну из 2 ошибок.

```python
import os.path

n = input()

if os.path.isdir(n):
    print('ERROR:')
    print('Это каталог, а не файл')
else:
    if os.path.isfile(n):
        print('CONTENT:')
        with open(n, 'r') as f:
            for line in f:
                print(line)
    else:
        print('ERROR:')
        print('Файл не существует')
```



<a id="text6"></a>
# Запись в файл

Для того чтобы писать что-то в файл сперва его необходимо открыть на запись или изменение, т.е. со флагом "w", "x", "+" или "a". _Ранее мы всегда открывали файл только на чтение со флагом "r"._

## write()

Самый простой способ записать что-то в файл - передать строку в функцию write, применяемую к файловому дескриптору:

```python
with open('text.txt', 'w', encoding='utf-8') as f:
    text = '''Привет, Мир!'''
    f.write(text)
```

![](https://ucarecdn.com/1b0c1a69-30b7-4d49-ae8c-cdb0b6e3666f/)

Функцию write можно применять несколько раз. Каждую новую переданную строку она будет записывать в файл сразу после предыдущей, склеивая их.

**write не добавляет переносы строк!**

![](https://ucarecdn.com/6e1b16b7-6a93-4fc2-ae4e-db5ccd49bca0/)

## writelines()

Функция writelines позволяет записать в файл последовательно все строки из переданного в неё списка. По сути это эквивалент вызова write() в цикле, т.к. переносы строк необходимо добавлять самостоятельно!

```python
with open('text.txt', 'w', encoding='utf-8') as f:
    text1 = '''Привет, Мир!'''
    text2 = '''Я - вторая строка'''
    f.writelines([text1, text2])
```

![](https://ucarecdn.com/298233a3-2062-4275-ab2d-c142735e56ed/)

## Разница между флагами "w" и "a"

Если файл уже существует, то открытие его с флагом "w" приведёт к полному уничтожению содержимого при новой записи. Открытие с флагом "a" позволяет дописывать новые строки в конец файла.

![](https://ucarecdn.com/9f0d5753-3793-4548-9032-a995da6b35a0/)

При этом вам не удастся переместить курсор с помощью seek() для записи в начало:

![](https://ucarecdn.com/7c0eece6-d406-4db7-9e2e-cb1eb78194a2/)

### А если файла нет?

Открытие файла на запись создаст файл.



<a id="task7"></a>
**Задание 7.**

Считайте строку, подаваемую на вход и запишите её в файл "output.txt".

```python
import os.path

with open('output.txt', 'w', encoding='utf-8') as f:
    f.write(input())
```



<a id="task8"></a>
**Задание 8.**

Считайте строку, подаваемую на вход и запишите её в файл "output.txt".

```python
import os.path

with open('output.txt', 'w', encoding='utf-8') as f:
    f.write(input())
```



<a id="task9"></a>
**Задание 9.**

- event - переменная с текстом события
- file_name - имя файла с логом

Файл с логом содержит записи о некоторых событиях вида:

```dos
event 3 - 'git log -2'
event 2 - 'git log'
event 1 - 'git status'
```

Пример нового события:

```dos
git fetch origin
```

Дополните лог в файле так, чтобы новое событие было записано вверху. Не забудьте указать порядковый номер события.

```dos
event 4 - 'git fetch origin'
event 3 - 'git log -2'
event 2 - 'git log'
event 1 - 'git status'
```

Если файл отсутствует или не содержит записей, начните нумеровать события с 1.

Не забывайте про переносы строк!

_**Примечание.** Гарантируется, что путь не указывает на каталог. Т.е. ситуация когда файла нет и его невозможно создать исключена._

_**Примечание.** В логе могут быть пустые строки_


```python
import os.path

if not os.path.isfile(file_name):
    with open(file_name, 'w', encoding='utf-8') as f:
        f.write('event 1 - ' + "'" + event + "'\n")
else:
    with open(file_name, 'r', encoding='utf-8') as f:
        text = f.readline()
        num = int(text.split()[1]) + 1
        new_text = 'event ' + str(num) + ' - ' + "'" + event + "'\n"
    with open(file_name, 'r', encoding='utf-8') as f:
        text = new_text + f.read()
    with open(file_name, 'w', encoding='utf-8') as f:
        f.write(text)
```
